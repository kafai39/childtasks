<html>
<head>
    <link href="css/bootstrap.min.css" rel="stylesheet" >
    <link href="css/custom.css" rel="stylesheet" >
    <script src="js/jquery-3.6.0.min.js" ></script>
    <script src="js/bootstrap.bundle.min.js" ></script>    
    <script src="js/moment.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";
  const firebaseConfig = {
    apiKey: "AIzaSyDra_j4zrn-tZHx8X3ZhtcVEW8kylvTbME",
    authDomain: "child-tasks.firebaseapp.com",
    databaseURL: "https://child-tasks-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "child-tasks",
    storageBucket: "child-tasks.appspot.com",
    messagingSenderId: "23491337274",
    appId: "1:23491337274:web:340c853d464d7877d9e903",
    measurementId: "G-VVPNFN0X30"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig); 

  import {getDatabase, ref, get, set, child, update, remove } 
  from "https://www.gstatic.com/firebasejs/9.6.7/firebase-database.js";

  const db = getDatabase();
  const dbref = ref(db);
  const urlSearchParams = new URLSearchParams(window.location.search);
  const params = Object.fromEntries(urlSearchParams.entries());
  $(document).ready(function(){
    GetUserInfo();
  });

  function GetUserInfo(){
    get(child(dbref,"Users/")).then((users)=>{
      console.log(users.val());
      var userInfo = users.val().find(n=>n.UserId == params.user);
      $(".user-profile-pic img").attr("src", userInfo.ImageURL);
      
      $("#username-info").html("Hello, " + userInfo.UserName);
    });

    //var todayStr = moment().format("MMMM DD YYYY");
    //$("#today-info").html(todayStr);
    //console.log(params.user);
  }

  get(child(dbref,"Tasks/")).then((tasks)=>{
    if (tasks.exists()){
        console.log(tasks.val());
        var childTasks = tasks.val();
        $(childTasks).each(function(){ 
            if (parseInt(this.Score)>0){
            var taskHtml = `<label class="todo">
                          <input class="todo__state" value="`+this.ID+`" data-score="`+this.Score+`" type="checkbox" />
                          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 200 25" class="todo__icon">
                            <use xlink:href="#todo__line" class="todo__line"></use>
                            <use xlink:href="#todo__box" class="todo__box"></use>
                            <use xlink:href="#todo__check" class="todo__check"></use>
                            <use xlink:href="#todo__circle" class="todo__circle"></use>
                          </svg>
                          <div class="todo__text">`+this.Name+`</div>
                        </label>`;         
            $(".todo-list").append(taskHtml);
                      }
                      else
                      {
                        var taskHtml = `<label class="todo todo_red">
                          <input class="todo__state" value="`+this.ID+`" data-score="`+this.Score+`" type="checkbox" />
                          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 200 25" class="todo__icon">
                            <use xlink:href="#todo__line_red" class="todo__line"></use>
                            <use xlink:href="#todo__box_red" class="todo__box"></use>
                            <use xlink:href="#todo__check_red" class="todo__check"></use>
                            <use xlink:href="#todo__circle_red" class="todo__circle"></use>
                          </svg>
                          <div class="todo__text">`+this.Name+`</div>
                        </label>`;         
            $(".dont-do-list").append(taskHtml);
                      }
 
        });
        //users.val().find(n=>n.Score == 20);
    }
});

  </script>
  <style>
    #main-body{
      height: 100% !important;
    }
    #top-info{
      font-size: 1.5em;
    }

    #top-info > div {
      display: inline-block;
    }
    #today-info {
      float: right;
    }
    .full-width-container{
      width: 100%;
      max-width: 980px;
    }
  </style>
</head>
<body>

    <section class="gradient-custom-2" id="main-body">
        <div class="container full-width-container">
          <div id="top-info">
              <div id="username-info" class="p-2 text-white"> 
              </div>
              <div id="userscore-info" class="p-2 text-white">
              </div>
          </div>
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-12 col-xl-10">
      
              <div class="card mask-custom">
                <div class="card-body p-4 text-white">
      
                  <div class="text-center pt-3 pb-2">
                    <div class="user-profile-pic"> 
                      <img src="" alt="Photo" width="120">
                    </div>
                    
                    <h2 class="my-4">儲FUN Actions</h2>
                  </div>
      
                  <svg viewBox="0 0 0 0" style="position: absolute; z-index: -1; opacity: 0;">
                    <defs>
                      <linearGradient id="boxGradient" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2="25" y2="25">
                        <stop offset="0%"   stop-color="#27FDC7"/>
                        <stop offset="100%" stop-color="#0FC0F5"/>
                      </linearGradient>
                  
                      <linearGradient id="lineGradient">
                        <stop offset="0%"    stop-color="#0FC0F5"/>
                        <stop offset="100%"  stop-color="#27FDC7"/>
                      </linearGradient>
                  
                      <path id="todo__line" stroke="url(#lineGradient)" d="M21 12.3h168v0.1z"></path>
                      <path id="todo__box" stroke="url(#boxGradient)" d="M21 12.7v5c0 1.3-1 2.3-2.3 2.3H8.3C7 20 6 19 6 17.7V7.3C6 6 7 5 8.3 5h10.4C20 5 21 6 21 7.3v5.4"></path>
                      <path id="todo__check" stroke="url(#boxGradient)" d="M10 13l2 2 5-5"></path>
                      <circle id="todo__circle" cx="13.5" cy="12.5" r="10"></circle>
                    </defs>
                  </svg>

                  <svg viewBox="0 0 0 0" style="position: absolute; z-index: -1; opacity: 0;">
                    <defs>
                      <linearGradient id="boxGradient_red" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2="25" y2="25">
                        <stop offset="0%"   stop-color="rgb(240, 154, 154)"/>
                        <stop offset="100%" stop-color="rgb(255, 0, 0)"/>
                      </linearGradient>
                  
                      <linearGradient id="lineGradient_red">
                        <stop offset="0%"    stop-color="rgb(255, 0, 0)"/>
                        <stop offset="100%"  stop-color="rgb(240, 154, 154)"/>
                      </linearGradient>
                  
                      <path id="todo__line_red" stroke="url(#lineGradient_red)" d="M21 12.3h168v0.1z"></path>
                      <path id="todo__box_red" stroke="url(#boxGradient_red)" d="M21 12.7v5c0 1.3-1 2.3-2.3 2.3H8.3C7 20 6 19 6 17.7V7.3C6 6 7 5 8.3 5h10.4C20 5 21 6 21 7.3v5.4"></path>
                      <path id="todo__check_red" stroke="url(#boxGradient_red)" d="M10 13l2 2 5-5"></path>
                      <circle id="todo__circle_red" cx="13.5" cy="12.5" r="10"></circle>
                    </defs>
                  </svg>
                  
                  
                  <div class="todo-list">
                  </div>
      
                  <div class="text-center pt-3 pb-2">
                    <h2 class="my-4">扣FUN Actions</h2>
                  </div>
                  <div class="dont-do-list">
                  </div>
      
                </div>
              </div>
      
            </div>
          </div>
        </div>
      </section>

</body>
</html>